<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Магазин товаров</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function start_result(e)
        {
            let result = e.target.response;
            // Распаковка двумерного массива из строки в формате JSON
            let table = JSON.parse(result);
            //тут составим таблицу
            html = '<table border="1px" width="300px" align="center">';
            for(let i of table)
            {
                html += '<tr>';
                for (let j of i)
                {
                    html += '<td>' + String(j) + '</td>';
                }
                html += "</tr>";
            }   
            html += "</table>";
            document.getElementById('1').innerHTML = html;
        }

        function start(){
            let oReq = new XMLHttpRequest();
            oReq.onload = start_result;
            let url = '/cgi-bin/getgoods.py';
            oReq.open('GET', url);
            oReq.send();
        }
    
        function insert_result(e) {
            start()
        }
        function insert_goods() {
            let oReq = new XMLHttpRequest();
            oReq.onload = insert_result;

            let name = document.getElementById('2').value;
            let price = document.getElementById('3').value;

            let url = '/cgi-bin/insert_goods.py?name=' + name + '&price=' + price;
            oReq.open('GET', url);
            oReq.send();
        }
        function delete_result(e) {
            start()
        }
        function delete_goods() {
            let oReq = new XMLHttpRequest();
            oReq.onload = delete_result;

            let id = document.getElementById('4').value;
            

            let url = '/cgi-bin/delete_goods.py?id=' + id;
            oReq.open('GET', url);
            oReq.send();
        }
        function update_result(e) {
            start()
        }
        function update_goods() {
            let oReq = new XMLHttpRequest();
            oReq.onload = delete_result;

            let id = document.getElementById('4').value;
            let name = document.getElementById('2').value;
            let price = document.getElementById('3').value;

            let url = '/cgi-bin/update_goods.py?id='+ id + '&name=' + name + '&price=' + price;
            oReq.open('GET', url);
            oReq.send();
        }
        
        function result_stat_sql(e)
        {
            let result = e.target.response;
            let table = JSON.parse(result);
            document.getElementById(table[1]).innerHTML = table[0];
        }
        function stats_sql(fun_name, result_id)
        {
            let oReq = new XMLHttpRequest();
            oReq.onload = result_stat_sql;
            let url = '/cgi-bin/getstat_sql.py?fun_name=' + fun_name + '&result_id=' + result_id;
            oReq.open('GET', url);
            oReq.send();
        }
        
    </script>
</head>
<body onload="start()">
    <p id="1"></p>
    <p>
        Наименование
        &nbsp;
        <input id="2">
        &nbsp;
        Цена
        &nbsp;
        <input id="3">
        &nbsp;
        <button onclick="insert_goods()">Добавить</button>
    </p>
    <p>
        id
        &nbsp;
        <input id="4">
        &nbsp;
        <button onclick="delete_goods()">Удалить</button>
    </p>
    <p>
        id
        &nbsp;
        <input id="5">
        &nbsp;
        Наименование
        &nbsp;
        <input id="6">
        &nbsp;
        Цена
        &nbsp;
        <input id="7">
        &nbsp;
        <button onclick="update_goods()">Изменить</button>
    </p>
    <button id="8" onclick="stats_sql('max', 8)">max(sql)</button>
    <br>
    <button id="9" onclick="stats_sql('min', 9)">min(sql)</button>
    <br>
    <button id="10" onclick="stats_sql('avg', 10)">avg(sql)</button>
</body>
</html>